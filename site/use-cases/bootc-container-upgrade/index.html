
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation page for the Red Hat Enterprise Linux (RHEL) Image mode demo hosted on GitHub.">
      
      
        <meta name="author" content="Alessandro Rossi - Red Hat">
      
      
      
        <link rel="prev" href="../bootc-container-anaconda-ks/">
      
      
        <link rel="next" href="../bootc-container-replace/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.33">
    
    
      
        <title>Update a VM based on a RHEL bootc container as a source adding packages and configuration - Red Hat Enterprise Linux Image Mode demo</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Red+Hat+Display:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Red Hat Display";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#use-case-upgrading-a-vm-based-on-a-bootc-image" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Red Hat Enterprise Linux Image Mode demo" class="md-header__button md-logo" aria-label="Red Hat Enterprise Linux Image Mode demo" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Red Hat Enterprise Linux Image Mode demo
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Update a VM based on a RHEL bootc container as a source adding packages and configuration
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/redhat-cop/redhat-image-mode-demo/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Red Hat Enterprise Linux Image Mode demo" class="md-nav__button md-logo" aria-label="Red Hat Enterprise Linux Image Mode demo" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    Red Hat Enterprise Linux Image Mode demo
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/redhat-cop/redhat-image-mode-demo/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introducing RHEL Image mode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/quickstart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quickstart
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Use Cases
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Use Cases
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bootc-container-simple/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Build a simple RHEL container
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bootc-container-httpd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Build an Apache RHEL image
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bootc-container-anaconda-ks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Use a RHEL bootc container to spin up a RHEL 9 VM with Anaconda and Kickstart
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Update a VM based on a RHEL bootc container as a source adding packages and configuration
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Update a VM based on a RHEL bootc container as a source adding packages and configuration
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#building-the-image" class="md-nav__link">
    <span class="md-ellipsis">
      Building the image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-the-image" class="md-nav__link">
    <span class="md-ellipsis">
      Testing the image
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing the image">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing-apache" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Apache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-mariadb" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Mariadb
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tagging-and-pushing-the-image" class="md-nav__link">
    <span class="md-ellipsis">
      Tagging and pushing the image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#updating-the-vm-with-the-newly-created-image" class="md-nav__link">
    <span class="md-ellipsis">
      Updating the VM with the newly created image
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bootc-container-replace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Apply a different RHEL container image to an existing VM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bootc-image-builder-qcow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Generate a RHEL QCOW image for a VM using bootc-image-builder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bootc-image-builder-iso/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Generate a RHEL ISO image for a VM using bootc-image-builder
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bootc-image-builder-ami/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Generate a RHEL AMI image for an AWS instance using bootc-image-builder
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#building-the-image" class="md-nav__link">
    <span class="md-ellipsis">
      Building the image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-the-image" class="md-nav__link">
    <span class="md-ellipsis">
      Testing the image
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing the image">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing-apache" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Apache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-mariadb" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Mariadb
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tagging-and-pushing-the-image" class="md-nav__link">
    <span class="md-ellipsis">
      Tagging and pushing the image
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#updating-the-vm-with-the-newly-created-image" class="md-nav__link">
    <span class="md-ellipsis">
      Updating the VM with the newly created image
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="use-case-upgrading-a-vm-based-on-a-bootc-image">Use Case - Upgrading a VM based on a bootc image</h1>
<p>In this example, we want to add some bits to the <a href="../bootc-container-anaconda-ks/">previously generated httpd image</a> to add a <a href="https://mariadb.org/">MariaDB server</a> and a text editor, <a href="https://www.vim.org/">VIM</a>.</p>
<p>We will then use <strong>bootc</strong> to manage the system update, and you will see how easy and fast perfoming upgrades is.</p>
<p>The Containerfile in this example will:</p>
<ul>
<li>Updates packages</li>
<li>Installs tmux and mkpasswd to create a simple user password</li>
<li>Creates a <em>bootc-user</em> user in the image</li>
<li>Adds the wheel group to sudoers</li>
<li>Installs <a href="https://httpd.apache.org/">Apache Server</a></li>
<li>Enables the systemd unit for httpd</li>
<li>Adds a custom index.html</li>
<li>Customizes the Message of the day</li>
</ul>
<p>But it will add the following two steps, resulting in a different image with an additional layer:</p>
<p><strong>- Add an additional message of the day with the upgrade notes</strong> </p>
<p><strong>- Add mariadb-server package and vim</strong> </p>
<p><strong>- Enable the mariadb systemd unit</strong> </p>
<details>
  <summary>Review Containerfile.replace</summary>
  <div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">MAINTAINER</span><span class="w"> </span><span class="s">Alessandro Rossi &lt;al.rossi87@gmail.com&gt;</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="k">FROM</span><span class="w"> </span><span class="s">registry.redhat.io/rhel9/rhel-bootc:9.4</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="k">RUN</span><span class="w"> </span>dnf<span class="w"> </span>-y<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>dnf<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>tmux<span class="w"> </span>mkpasswd
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="k">RUN</span><span class="w"> </span><span class="nv">pass</span><span class="o">=</span><span class="k">$(</span>mkpasswd<span class="w"> </span>--method<span class="o">=</span>SHA-512<span class="w"> </span>--rounds<span class="o">=</span><span class="m">4096</span><span class="w"> </span>redhat<span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>useradd<span class="w"> </span>-m<span class="w"> </span>-G<span class="w"> </span>wheel<span class="w"> </span>bootc-user<span class="w"> </span>-p<span class="w"> </span><span class="nv">$pass</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="k">RUN</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;%wheel        ALL=(ALL)       NOPASSWD: ALL&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/etc/sudoers.d/wheel-sudo
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="k">RUN</span><span class="w"> </span>dnf<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>httpd<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>httpd<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">    </span>mv<span class="w"> </span>/var/www<span class="w"> </span>/usr/share/www<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">    </span>sed<span class="w"> </span>-ie<span class="w"> </span><span class="s1">&#39;s,/var/www,/usr/share/www,&#39;</span><span class="w"> </span>/etc/httpd/conf/httpd.conf
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="k">RUN</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Welcome to the bootc-http instance! \nThe OS update was successful and you are now running an instance with MariaDB&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/usr/share/www/html/index.html
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="k">RUN</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;This is a RHEL VM installed using a bootable container as an rpm-ostree source!&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/etc/motd.d/10-first-setup.motd
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="k">RUN</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;This server now supports MariaDB as a database, after last update&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/etc/motd.d/20-upgrade.motd
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="k">RUN</span><span class="w"> </span>dnf<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>mariadb<span class="w"> </span>mariadb-server<span class="w"> </span>vim<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>dnf<span class="w"> </span>clean<span class="w"> </span>all<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/var/cache<span class="w"> </span>/var/log/dnf<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>mariadb
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="k">COPY</span><span class="w"> </span>./files/00-mariadb-tmpfile.conf<span class="w"> </span>/usr/lib/tmpfiles.d/
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">80 3306</span>
</span></code></pre></div>
</details>

<p>Since the <em>bootc update</em> command will preserve the /var and /etc content, we will use a workaround to create the needed dirs for MariaDB leveraging <strong>systemd tmpfiles</strong>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>d<span class="w"> </span>/var/lib/mysql<span class="w"> </span><span class="m">0755</span><span class="w"> </span>mysql<span class="w"> </span>-<span class="w"> </span>365d
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>d<span class="w"> </span>/var/log/mariadb<span class="w"> </span><span class="m">0755</span><span class="w"> </span>mysql<span class="w"> </span>-<span class="w"> </span>365d
</span></code></pre></div>
<h2 id="building-the-image">Building the image</h2>
<p>From the root folder of the repository, switch to the use case directory:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nb">cd</span><span class="w"> </span>use-cases/bootc-container-upgrade
</span></code></pre></div>
<p>You can build the image right from the Containerfile using Podman:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>podman<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>Containerfile.upgrade<span class="w"> </span>-t<span class="w"> </span>rhel-bootc-vm:httpd<span class="w"> </span>.
</span></code></pre></div>
<h2 id="testing-the-image">Testing the image</h2>
<p>You can now test it using:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>podman<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--name<span class="w"> </span>rhel-bootc-vm<span class="w"> </span>--hostname<span class="w"> </span>rhel-bootc-vm<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:80<span class="w"> </span>-p<span class="w"> </span><span class="m">3306</span>:3306<span class="w"> </span>rhel-bootc-vm:httpd
</span></code></pre></div>
<p>Note: The <em>"-p 8080:80" -p 3306:3306</em> part forwards the container's <em>http</em> and <em>mariadb</em> port to the port 8080 and 3306 on the host to test that httpd and mariadb are working.</p>
<p>The container will now start and a login prompt will appear:</p>
<p><img alt="" src="assets/bootc-container.png" /></p>
<h3 id="testing-apache">Testing Apache</h3>
<p>On another terminal tab or in your browser, you can verify that the httpd server is working and serving traffic.</p>
<p><strong>Terminal</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="w"> </span>~<span class="w"> </span>▓▒░<span class="w"> </span>curl<span class="w"> </span>localhost:8080<span class="w">                                                                                                           </span>░▒▓<span class="w"> </span>✔<span class="w">  </span><span class="m">11</span>:59:44
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>Welcome<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>bootc-http<span class="w"> </span>instance!
</span></code></pre></div>
<p><strong>Browser</strong></p>
<p><img alt="" src="assets/browser-test.png" /></p>
<h3 id="testing-mariadb">Testing Mariadb</h3>
<p>From the login prompt, login as <strong>bootc-user/redhat</strong> and impersonate the root user:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="o">[</span>bootc-user@rhel-bootc-vm<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>sudo<span class="w"> </span>-i
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="o">[</span>root@rhel-bootc-vm<span class="w"> </span>~<span class="o">]</span><span class="c1">#</span>
</span></code></pre></div>
<p>Verify that mariadb is running:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>mysql
</span></code></pre></div>
<h2 id="tagging-and-pushing-the-image">Tagging and pushing the image</h2>
<p>To tag and push the image you can simply run (replace <strong>YOURQUAYUSERNAME</strong> with the account name):</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">QUAY_USER</span><span class="o">=</span>YOURQUAYUSERNAME
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>podman<span class="w"> </span>tag<span class="w"> </span>rhel-bootc-vm:httpd<span class="w"> </span>quay.io/<span class="nv">$QUAY_USER</span>/rhel-bootc-vm:httpd
</span></code></pre></div>
<p>Log-in to Quay.io:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>podman<span class="w"> </span>login<span class="w"> </span>-u<span class="w"> </span><span class="nv">$QUAY_USER</span><span class="w"> </span>quay.io
</span></code></pre></div>
<p>And push the image:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>podman<span class="w"> </span>push<span class="w"> </span>quay.io/<span class="nv">$QUAY_USER</span>/rhel-bootc-vm:httpd
</span></code></pre></div>
<p>You can now browse to <a href="https://quay.io/repository/YOURQUAYUSERNAME/rhel-bootc-httpd?tab=settings">https://quay.io/repository/YOURQUAYUSERNAME/rhel-bootc-httpd?tab=settings</a> and ensure that the repository is set to <strong>"Public"</strong>.</p>
<p><img alt="" src="assets/quay-repo-public.png" /></p>
<h2 id="updating-the-vm-with-the-newly-created-image">Updating the VM with the newly created image</h2>
<p>The first thing to do is logging in the VM created in the <a href="../bootc-container-anaconda-ks/">previous use case</a> or any other use case (QCOW, ISO, AMI):</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="w"> </span>~<span class="w"> </span>▓▒░<span class="w"> </span>ssh<span class="w"> </span>bootc-user@192.168.124.16
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>bootc-user@192.168.124.16<span class="err">&#39;</span>s<span class="w"> </span>password:<span class="w"> </span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>This<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>RHEL<span class="w"> </span><span class="m">9</span>.4<span class="w"> </span>VM<span class="w"> </span>installed<span class="w"> </span>using<span class="w"> </span>a<span class="w"> </span>bootable<span class="w"> </span>container<span class="w"> </span>as<span class="w"> </span>an<span class="w"> </span>rpm-ostree<span class="w"> </span>source!
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>Last<span class="w"> </span>login:<span class="w"> </span>Mon<span class="w"> </span>Jul<span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">12</span>:03:40<span class="w"> </span><span class="m">2024</span><span class="w"> </span>from<span class="w"> </span><span class="m">192</span>.168.124.1
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="o">[</span>bootc-user@localhost<span class="w"> </span>~<span class="o">]</span>$
</span></code></pre></div>
<p>Verify that bootc is installed:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="o">[</span>bootc-user@localhost<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>bootc<span class="w"> </span>--help
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>Deploy<span class="w"> </span>and<span class="w"> </span>transactionally<span class="w"> </span><span class="k">in</span>-place<span class="w"> </span>with<span class="w"> </span>bootable<span class="w"> </span>container<span class="w"> </span>images.
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>The<span class="w"> </span><span class="sb">`</span>bootc<span class="sb">`</span><span class="w"> </span>project<span class="w"> </span>currently<span class="w"> </span>uses<span class="w"> </span>ostree-containers<span class="w"> </span>as<span class="w"> </span>a<span class="w"> </span>backend<span class="w"> </span>to<span class="w"> </span>support<span class="w"> </span>a<span class="w"> </span>model<span class="w"> </span>of<span class="w"> </span>bootable<span class="w"> </span>container<span class="w"> </span>images.<span class="w">  </span>Once<span class="w"> </span>installed,<span class="w"> </span>whether<span class="w"> </span>directly<span class="w"> </span>via<span class="w"> </span><span class="sb">`</span>bootc<span class="w"> </span>install<span class="sb">`</span><span class="w"> </span><span class="o">(</span>executed<span class="w"> </span>as<span class="w"> </span>part<span class="w"> </span>of<span class="w"> </span>a<span class="w"> </span>container<span class="o">)</span><span class="w"> </span>or<span class="w"> </span>via<span class="w"> </span>another<span class="w"> </span>mechanism<span class="w"> </span>such<span class="w"> </span>as<span class="w"> </span>an<span class="w"> </span>OS<span class="w"> </span>installer<span class="w"> </span>tool,<span class="w"> </span>further<span class="w"> </span>updates<span class="w"> </span>can<span class="w"> </span>be<span class="w"> </span>pulled<span class="w"> </span>via<span class="w"> </span>e.g.<span class="w"> </span><span class="sb">`</span>bootc<span class="w"> </span>upgrade<span class="sb">`</span>.
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>Changes<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="sb">`</span>/etc<span class="sb">`</span><span class="w"> </span>and<span class="w"> </span><span class="sb">`</span>/var<span class="sb">`</span><span class="w"> </span>persist.
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>Usage:<span class="w"> </span>bootc<span class="w"> </span>&lt;COMMAND&gt;
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>Commands:
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="w">  </span>upgrade<span class="w">      </span>Download<span class="w"> </span>and<span class="w"> </span>queue<span class="w"> </span>an<span class="w"> </span>updated<span class="w"> </span>container<span class="w"> </span>image<span class="w"> </span>to<span class="w"> </span>apply
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="w">  </span>switch<span class="w">       </span>Target<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>container<span class="w"> </span>image<span class="w"> </span>reference<span class="w"> </span>to<span class="w"> </span>boot
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="w">  </span>edit<span class="w">         </span>Apply<span class="w"> </span>full<span class="w"> </span>changes<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>host<span class="w"> </span>specification
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="w">  </span>status<span class="w">       </span>Display<span class="w"> </span>status
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="w">  </span>usr-overlay<span class="w">  </span>Add<span class="w"> </span>a<span class="w"> </span>transient<span class="w"> </span>writable<span class="w"> </span>overlayfs<span class="w"> </span>on<span class="w"> </span><span class="sb">`</span>/usr<span class="sb">`</span><span class="w"> </span>that<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>discarded<span class="w"> </span>on<span class="w"> </span>reboot
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="w">  </span>install<span class="w">      </span>Install<span class="w"> </span>the<span class="w"> </span>running<span class="w"> </span>container<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>target
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="w">  </span><span class="nb">help</span><span class="w">         </span>Print<span class="w"> </span>this<span class="w"> </span>message<span class="w"> </span>or<span class="w"> </span>the<span class="w"> </span><span class="nb">help</span><span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>given<span class="w"> </span>subcommand<span class="o">(</span>s<span class="o">)</span>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>Options:
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a><span class="w">  </span>-h,<span class="w"> </span>--help<span class="w">   </span>Print<span class="w"> </span><span class="nb">help</span><span class="w"> </span><span class="o">(</span>see<span class="w"> </span>a<span class="w"> </span>summary<span class="w"> </span>with<span class="w"> </span><span class="s1">&#39;-h&#39;</span><span class="o">)</span>
</span></code></pre></div>
<p>Note that among the options we have the <strong>upgrade</strong> option that we will be using in this use case.
The upgrade option allows checking, fetching and using any updated container image corresponding to the <em>imagename:tag</em> we used, in this case <strong>quay.io/YOURQUAYUSERNAME/rhel-bootc-vm:httpd</strong></p>
<p>The upgrade command requires higher privileges to run, let's perform the upgrade!</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="o">[</span>bootc-user@localhost<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>sudo<span class="w"> </span>bootc<span class="w"> </span>upgrade
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>layers<span class="w"> </span>already<span class="w"> </span>present:<span class="w"> </span><span class="m">71</span><span class="p">;</span><span class="w"> </span>layers<span class="w"> </span>needed:<span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="o">(</span><span class="m">99</span>.3<span class="w"> </span>MB<span class="o">)</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w"> </span><span class="m">379</span><span class="w"> </span>B<span class="w"> </span><span class="o">[</span>████████████████████<span class="o">]</span><span class="w"> </span><span class="o">(</span>0s<span class="o">)</span><span class="w"> </span>Fetched<span class="w"> </span>layer<span class="w"> </span>sha256:3851db6a0d50<span class="w">                                                                                                                                                                                                                                                                                                                                            </span>Queued<span class="w"> </span><span class="k">for</span><span class="w"> </span>next<span class="w"> </span>boot:<span class="w"> </span>quay.io/kubealex/rhel-bootc-vm:httpd
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">  </span>Version:<span class="w"> </span><span class="m">9</span>.20240714.0
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="w">  </span>Digest:<span class="w"> </span>sha256:09ceaf9cc673ddd49ca204216433c688b09418e24992492b7f0e46ef27f4d5a5
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>Total<span class="w"> </span>new<span class="w"> </span>layers:<span class="w"> </span><span class="m">75</span><span class="w">    </span>Size:<span class="w"> </span><span class="m">1</span>.3<span class="w"> </span>GB
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>Removed<span class="w"> </span>layers:<span class="w">   </span><span class="m">1</span><span class="w">     </span>Size:<span class="w"> </span><span class="m">403</span><span class="w"> </span>bytes
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>Added<span class="w"> </span>layers:<span class="w">     </span><span class="m">4</span><span class="w">     </span>Size:<span class="w"> </span><span class="m">99</span>.3<span class="w"> </span>MB
</span></code></pre></div>
<p>As you can see, at the beginning it performs a comparison between the actual rpm-ostree image that the system is booted from and the new image, fetching <strong>only the additional layer</strong> corresponding to the updates introduced during the last build.</p>
<p>Verify that mariadb is still not present at this time, and proceed with a reboot:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="o">[</span>bootc-user@localhost<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>mariadb
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>Unit<span class="w"> </span>mariadb.service<span class="w"> </span>could<span class="w"> </span>not<span class="w"> </span>be<span class="w"> </span>found.
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="o">[</span>bootc-user@localhost<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>sudo<span class="w"> </span>reboot
</span></code></pre></div>
<p>Let's log back in!</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="w"> </span>~<span class="w"> </span>▓▒░<span class="w"> </span>ssh<span class="w"> </span>bootc-user@192.168.124.16
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>bootc-user@192.168.124.16<span class="err">&#39;</span>s<span class="w"> </span>password:<span class="w"> </span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>This<span class="w"> </span>is<span class="w"> </span>a<span class="w"> </span>RHEL<span class="w"> </span>VM<span class="w"> </span>installed<span class="w"> </span>using<span class="w"> </span>a<span class="w"> </span>bootable<span class="w"> </span>container<span class="w"> </span>as<span class="w"> </span>an<span class="w"> </span>rpm-ostree<span class="w"> </span>source!
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>This<span class="w"> </span>server<span class="w"> </span>now<span class="w"> </span>supports<span class="w"> </span>MariaDB<span class="w"> </span>as<span class="w"> </span>a<span class="w"> </span>database,<span class="w"> </span>after<span class="w"> </span>last<span class="w"> </span>update
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>Last<span class="w"> </span>login:<span class="w"> </span>Mon<span class="w"> </span>Jul<span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">12</span>:10:44<span class="w"> </span><span class="m">2024</span><span class="w"> </span>from<span class="w"> </span><span class="m">192</span>.168.124.1
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="o">[</span>bootc-user@localhost<span class="w"> </span>~<span class="o">]</span>$
</span></code></pre></div>
<p>You can already see that something changed, we have a new line in our message of the day, let's see if mariadb is running and test it using the default root user that is created by default (using sudo!):</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="o">[</span>bootc-user@localhost<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>mariadb
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>●<span class="w"> </span>mariadb.service<span class="w"> </span>-<span class="w"> </span>MariaDB<span class="w"> </span><span class="m">10</span>.5<span class="w"> </span>database<span class="w"> </span>server
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">     </span>Loaded:<span class="w"> </span>loaded<span class="w"> </span><span class="o">(</span>/usr/lib/systemd/system/mariadb.service<span class="p">;</span><span class="w"> </span>enabled<span class="p">;</span><span class="w"> </span>preset:<span class="w"> </span>disabled<span class="o">)</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">     </span>Active:<span class="w"> </span>active<span class="w"> </span><span class="o">(</span>running<span class="o">)</span><span class="w"> </span>since<span class="w"> </span>Mon<span class="w"> </span><span class="m">2024</span>-07-29<span class="w"> </span><span class="m">12</span>:12:27<span class="w"> </span>CEST<span class="p">;</span><span class="w"> </span>44s<span class="w"> </span>ago
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">       </span>Docs:<span class="w"> </span>man:mariadbd<span class="o">(</span><span class="m">8</span><span class="o">)</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">             </span>https://mariadb.com/kb/en/library/systemd/
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">    </span>Process:<span class="w"> </span><span class="m">676</span><span class="w"> </span><span class="nv">ExecStartPre</span><span class="o">=</span>/usr/libexec/mariadb-check-socket<span class="w"> </span><span class="o">(</span><span class="nv">code</span><span class="o">=</span>exited,<span class="w"> </span><span class="nv">status</span><span class="o">=</span><span class="m">0</span>/SUCCESS<span class="o">)</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">    </span>Process:<span class="w"> </span><span class="m">722</span><span class="w"> </span><span class="nv">ExecStartPre</span><span class="o">=</span>/usr/libexec/mariadb-prepare-db-dir<span class="w"> </span>mariadb.service<span class="w"> </span><span class="o">(</span><span class="nv">code</span><span class="o">=</span>exited,<span class="w"> </span><span class="nv">status</span><span class="o">=</span><span class="m">0</span>/SUCCESS<span class="o">)</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">    </span>Process:<span class="w"> </span><span class="m">1373</span><span class="w"> </span><span class="nv">ExecStartPost</span><span class="o">=</span>/usr/libexec/mariadb-check-upgrade<span class="w"> </span><span class="o">(</span><span class="nv">code</span><span class="o">=</span>exited,<span class="w"> </span><span class="nv">status</span><span class="o">=</span><span class="m">0</span>/SUCCESS<span class="o">)</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w">   </span>Main<span class="w"> </span>PID:<span class="w"> </span><span class="m">1359</span><span class="w"> </span><span class="o">(</span>mariadbd<span class="o">)</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="w">     </span>Status:<span class="w"> </span><span class="s2">&quot;Taking your SQL requests now...&quot;</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="w">      </span>Tasks:<span class="w"> </span><span class="m">13</span><span class="w"> </span><span class="o">(</span>limit:<span class="w"> </span><span class="m">23136</span><span class="o">)</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="w">     </span>Memory:<span class="w"> </span><span class="m">97</span>.1M
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="w">        </span>CPU:<span class="w"> </span>195ms
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="w">     </span>CGroup:<span class="w"> </span>/system.slice/mariadb.service
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="w">             </span>└─1359<span class="w"> </span>/usr/libexec/mariadbd<span class="w"> </span>--basedir<span class="o">=</span>/usr
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a>
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a>Jul<span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">12</span>:12:27<span class="w"> </span>localhost.localdomain<span class="w"> </span>mariadb-prepare-db-dir<span class="o">[</span><span class="m">1315</span><span class="o">]</span>:<span class="w"> </span>The<span class="w"> </span>second<span class="w"> </span>is<span class="w"> </span>mysql@localhost,<span class="w"> </span>it<span class="w"> </span>has<span class="w"> </span>no<span class="w"> </span>password<span class="w"> </span>either,<span class="w"> </span>but
</span><span id="__span-17-19"><a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a>Jul<span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">12</span>:12:27<span class="w"> </span>localhost.localdomain<span class="w"> </span>mariadb-prepare-db-dir<span class="o">[</span><span class="m">1315</span><span class="o">]</span>:<span class="w"> </span>you<span class="w"> </span>need<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>the<span class="w"> </span>system<span class="w"> </span><span class="s1">&#39;mysql&#39;</span><span class="w"> </span>user<span class="w"> </span>to<span class="w"> </span>connect.
</span><span id="__span-17-20"><a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a>Jul<span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">12</span>:12:27<span class="w"> </span>localhost.localdomain<span class="w"> </span>mariadb-prepare-db-dir<span class="o">[</span><span class="m">1315</span><span class="o">]</span>:<span class="w"> </span>After<span class="w"> </span>connecting<span class="w"> </span>you<span class="w"> </span>can<span class="w"> </span><span class="nb">set</span><span class="w"> </span>the<span class="w"> </span>password,<span class="w"> </span><span class="k">if</span><span class="w"> </span>you<span class="w"> </span>would<span class="w"> </span>need<span class="w"> </span>to<span class="w"> </span>be
</span><span id="__span-17-21"><a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a>Jul<span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">12</span>:12:27<span class="w"> </span>localhost.localdomain<span class="w"> </span>mariadb-prepare-db-dir<span class="o">[</span><span class="m">1315</span><span class="o">]</span>:<span class="w"> </span>able<span class="w"> </span>to<span class="w"> </span>connect<span class="w"> </span>as<span class="w"> </span>any<span class="w"> </span>of<span class="w"> </span>these<span class="w"> </span>users<span class="w"> </span>with<span class="w"> </span>a<span class="w"> </span>password<span class="w"> </span>and<span class="w"> </span>without<span class="w"> </span>sudo
</span><span id="__span-17-22"><a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a>Jul<span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">12</span>:12:27<span class="w"> </span>localhost.localdomain<span class="w"> </span>mariadb-prepare-db-dir<span class="o">[</span><span class="m">1315</span><span class="o">]</span>:<span class="w"> </span>See<span class="w"> </span>the<span class="w"> </span>MariaDB<span class="w"> </span>Knowledgebase<span class="w"> </span>at<span class="w"> </span>https://mariadb.com/kb
</span><span id="__span-17-23"><a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a>Jul<span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">12</span>:12:27<span class="w"> </span>localhost.localdomain<span class="w"> </span>mariadb-prepare-db-dir<span class="o">[</span><span class="m">1315</span><span class="o">]</span>:<span class="w"> </span>Please<span class="w"> </span>report<span class="w"> </span>any<span class="w"> </span>problems<span class="w"> </span>at<span class="w"> </span>https://mariadb.org/jira
</span><span id="__span-17-24"><a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a>Jul<span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">12</span>:12:27<span class="w"> </span>localhost.localdomain<span class="w"> </span>mariadb-prepare-db-dir<span class="o">[</span><span class="m">1315</span><span class="o">]</span>:<span class="w"> </span>The<span class="w"> </span>latest<span class="w"> </span>information<span class="w"> </span>about<span class="w"> </span>MariaDB<span class="w"> </span>is<span class="w"> </span>available<span class="w"> </span>at<span class="w"> </span>https://mariadb.org/.
</span><span id="__span-17-25"><a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a>Jul<span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">12</span>:12:27<span class="w"> </span>localhost.localdomain<span class="w"> </span>mariadb-prepare-db-dir<span class="o">[</span><span class="m">1315</span><span class="o">]</span>:<span class="w"> </span>Consider<span class="w"> </span>joining<span class="w"> </span>MariaDB<span class="err">&#39;</span>s<span class="w"> </span>strong<span class="w"> </span>and<span class="w"> </span>vibrant<span class="w"> </span>community:
</span><span id="__span-17-26"><a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a>Jul<span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">12</span>:12:27<span class="w"> </span>localhost.localdomain<span class="w"> </span>mariadb-prepare-db-dir<span class="o">[</span><span class="m">1315</span><span class="o">]</span>:<span class="w"> </span>https://mariadb.org/get-involved/
</span><span id="__span-17-27"><a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a>Jul<span class="w"> </span><span class="m">29</span><span class="w"> </span><span class="m">12</span>:12:27<span class="w"> </span>localhost.localdomain<span class="w"> </span>systemd<span class="o">[</span><span class="m">1</span><span class="o">]</span>:<span class="w"> </span>Started<span class="w"> </span>MariaDB<span class="w"> </span><span class="m">10</span>.5<span class="w"> </span>database<span class="w"> </span>server.
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="o">[</span>bootc-user@localhost<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>sudo<span class="w"> </span>mysql
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>Welcome<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>MariaDB<span class="w"> </span>monitor.<span class="w">  </span>Commands<span class="w"> </span>end<span class="w"> </span>with<span class="w"> </span><span class="p">;</span><span class="w"> </span>or<span class="w"> </span><span class="se">\g</span>.
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>Your<span class="w"> </span>MariaDB<span class="w"> </span>connection<span class="w"> </span>id<span class="w"> </span>is<span class="w"> </span><span class="m">3</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>Server<span class="w"> </span>version:<span class="w"> </span><span class="m">10</span>.5.22-MariaDB<span class="w"> </span>MariaDB<span class="w"> </span>Server
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>Copyright<span class="w"> </span><span class="o">(</span>c<span class="o">)</span><span class="w"> </span><span class="m">2000</span>,<span class="w"> </span><span class="m">2018</span>,<span class="w"> </span>Oracle,<span class="w"> </span>MariaDB<span class="w"> </span>Corporation<span class="w"> </span>Ab<span class="w"> </span>and<span class="w"> </span>others.
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>Type<span class="w"> </span><span class="s1">&#39;help;&#39;</span><span class="w"> </span>or<span class="w"> </span><span class="s1">&#39;\h&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>help.<span class="w"> </span>Type<span class="w"> </span><span class="s1">&#39;\c&#39;</span><span class="w"> </span>to<span class="w"> </span>clear<span class="w"> </span>the<span class="w"> </span>current<span class="w"> </span>input<span class="w"> </span>statement.
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>MariaDB<span class="w"> </span><span class="o">[(</span>none<span class="o">)]</span>&gt;<span class="w"> </span>
</span></code></pre></div>
<p>Here we go, our image is updated and fully working. Of course we can use the new image to provision similar VMs that need the same pieces of software on them.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "navigation.expand", "content.tooltips"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.af256bd8.min.js"></script>
      
    
  </body>
</html>